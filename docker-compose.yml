name: dump1090curses
services:
  regserver:
    build:
      context: /home/ubuntu/git/dump1090curses
      dockerfile: Dockerfile
    command:
      - gunicorn
      - --bind
      - 0.0.0.0:5001
      - --workers
      - "3"
      - --access-logfile
      - '-'
      - --error-logfile
      - '-'
      - --timeout
      - "120"
      - --preload
      - regserver:create_app()
    container_name: regserver
    environment:
      FLASK_ENV: production
      PORT: "5001"
      WEB_CONCURRENCY: "3"
    healthcheck:
      test:
        - CMD-SHELL
        - curl -fsS http://localhost:5001/health || exit 1
      timeout: 5s
      interval: 30s
      retries: 3
      start_period: 20s
    image: regserver:latest
    networks:
      default: null
    ports:
      - mode: ingress
        target: 5001
        published: "5001"
        protocol: tcp
    restart: unless-stopped
    volumes:
      - type: bind
        source: /home/ubuntu/git/dump1090curses/data
        target: /app/data
        bind: {}
      - type: bind
        source: /home/ubuntu/git/dump1090curses/log
        target: /app/log
        bind: {}
      - type: bind
        source: /home/ubuntu/git/dump1090curses/config.toml
        target: /app/config.toml
        read_only: true
        bind: {}
networks:
  default:
    name: regserver_default
